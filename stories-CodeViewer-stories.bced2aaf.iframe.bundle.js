"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[9872],{"./src/stories/CodeViewer.stories.jsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Default:()=>Default,Logged:()=>Logged,default:()=>CodeViewer_stories});var defineProperty=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/defineProperty.js"),esm_extends=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/extends.js"),react=__webpack_require__("./node_modules/next/dist/compiled/react/index.js"),toConsumableArray=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/toConsumableArray.js"),asyncToGenerator=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),objectWithoutProperties=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js"),regenerator=__webpack_require__("./node_modules/@babel/runtime/regenerator/index.js"),regenerator_default=__webpack_require__.n(regenerator),chunk_6CSUKJP7=__webpack_require__("./node_modules/@chakra-ui/layout/dist/chunk-6CSUKJP7.mjs"),chunk_ZWUY3VWT=__webpack_require__("./node_modules/@chakra-ui/tabs/dist/chunk-ZWUY3VWT.mjs"),chunk_ZWLVZLKQ=__webpack_require__("./node_modules/@chakra-ui/tabs/dist/chunk-ZWLVZLKQ.mjs"),chunk_TPBRUKW6=__webpack_require__("./node_modules/@chakra-ui/tabs/dist/chunk-TPBRUKW6.mjs"),chunk_NAA7TEES=__webpack_require__("./node_modules/@chakra-ui/button/dist/chunk-NAA7TEES.mjs"),chunk_UCTXUILV=__webpack_require__("./node_modules/@chakra-ui/tabs/dist/chunk-UCTXUILV.mjs"),chunk_45U2LZ4E=__webpack_require__("./node_modules/@chakra-ui/tabs/dist/chunk-45U2LZ4E.mjs"),chunk_7W5ZCZ76=__webpack_require__("./node_modules/@chakra-ui/tabs/dist/chunk-7W5ZCZ76.mjs"),chunk_LRMLOJAR=__webpack_require__("./node_modules/@chakra-ui/transition/dist/chunk-LRMLOJAR.mjs"),chunk_HEDGDMHJ=__webpack_require__("./node_modules/@chakra-ui/tooltip/dist/chunk-HEDGDMHJ.mjs"),chunk_WPAIWTI3=__webpack_require__("./node_modules/@chakra-ui/avatar/dist/chunk-WPAIWTI3.mjs"),next_router=__webpack_require__("./node_modules/next/router.js"),useTranslation=__webpack_require__("./node_modules/next-translate/lib/esm/useTranslation.js"),prop_types=__webpack_require__("./node_modules/prop-types/index.js"),prop_types_default=__webpack_require__.n(prop_types),dist=__webpack_require__("./node_modules/@monaco-editor/react/dist/index.mjs"),utils=__webpack_require__("./src/utils/index.js"),modifyEnv=__webpack_require__("./modifyEnv.js"),modalInfo=__webpack_require__("./src/js_modules/moduleMap/modalInfo.jsx"),useAuth=(__webpack_require__("./src/common/services/breathecode.js"),__webpack_require__("./src/common/hooks/useAuth.js")),useStyle=__webpack_require__("./src/common/hooks/useStyle.js"),Text=__webpack_require__("./src/common/components/Text.jsx"),Icon=__webpack_require__("./src/common/components/Icon/index.jsx"),process=__webpack_require__("./node_modules/process/browser.js"),console=__webpack_require__("./node_modules/console-browserify/index.js"),_excluded=["languagesData","allowNotLogged","stTranslation"],__jsx=react.createElement;function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function _objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(t),!0).forEach((function(r){(0,defineProperty.Z)(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}var notExecutables=["html","css"];function CodeViewer(_ref){var languagesData=_ref.languagesData,allowNotLogged=_ref.allowNotLogged,stTranslation=_ref.stTranslation,rest=(0,objectWithoutProperties.Z)(_ref,_excluded),router=(0,next_router.useRouter)(),hexColor=(0,useStyle.Z)().hexColor,_useTranslation=(0,useTranslation.Z)("code-viewer"),t=_useTranslation.t,lang=_useTranslation.lang,isAuthenticated=(0,useAuth.Z)().isAuthenticated,_useState=(0,react.useState)(0),tabIndex=_useState[0],setTabIndex=_useState[1],_useState2=(0,react.useState)(!1),showModal=_useState2[0],setShowModal=_useState2[1],_useState3=(0,react.useState)(languagesData),languages=_useState3[0],setLanguages=_useState3[1],BREATHECODE_HOST=(0,modifyEnv.Z)({queryString:"host",env:process.env.BREATHECODE_HOST}),getRigobotToken=function(){var _ref2=(0,asyncToGenerator.Z)(regenerator_default().mark((function _callee(){var rigobotToken,bcToken,resp,data;return regenerator_default().wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:if(rigobotToken=(0,utils.qn)("rigobotToken"),(rigobotToken=JSON.parse(rigobotToken))&&!(rigobotToken.expires_at<(new Date).toISOString())){_context.next=12;break}return bcToken=(0,utils.qn)("accessToken"),_context.next=6,fetch("https://rigobot.herokuapp.com/v1/auth/me/token?breathecode_token=".concat(bcToken,"&dev=true"));case 6:return resp=_context.sent,_context.next=9,resp.json();case 9:data=_context.sent,(0,utils.Nh)("rigobotToken",JSON.stringify(data)),rigobotToken=data;case 12:return _context.abrupt("return",rigobotToken.key);case 13:case"end":return _context.stop()}}),_callee)})));return function getRigobotToken(){return _ref2.apply(this,arguments)}}(),run=function(){var _ref3=(0,asyncToGenerator.Z)(regenerator_default().mark((function _callee2(){var currLanguage,_languages$tabIndex,code,language,rigobotToken,completionJob,completionRequest,completion;return regenerator_default().wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:if(!isAuthenticated&&!allowNotLogged){_context2.next=24;break}return _context2.prev=1,currLanguage=_objectSpread(_objectSpread({},languages[tabIndex]),{},{running:!0}),setLanguages([].concat((0,toConsumableArray.Z)(languages.slice(0,tabIndex)),[currLanguage],(0,toConsumableArray.Z)(languages.slice(tabIndex+1)))),_languages$tabIndex=languages[tabIndex],code=_languages$tabIndex.code,language=_languages$tabIndex.language,_context2.next=7,getRigobotToken();case 7:return rigobotToken=_context2.sent,completionJob={inputs:{code,language_and_version:language},execute_async:!1,include_organization_brief:!1,include_purpose_objective:!0},_context2.next=11,fetch("https://rigobot.herokuapp.com/v1/prompting/completion/code-compiler/",{method:"POST",body:JSON.stringify(completionJob),headers:{"Content-Type":"application/json",Authorization:"Token ".concat(rigobotToken)}});case 11:return completionRequest=_context2.sent,_context2.next=14,completionRequest.json();case 14:completion=_context2.sent,currLanguage.output=completion.answer.replace("---terminal output---","").replace("\n",""),setLanguages([].concat((0,toConsumableArray.Z)(languages.slice(0,tabIndex)),[currLanguage],(0,toConsumableArray.Z)(languages.slice(tabIndex+1)))),_context2.next=22;break;case 19:_context2.prev=19,_context2.t0=_context2.catch(1),console.log(_context2.t0);case 22:_context2.next=25;break;case 24:setShowModal(!0);case 25:case"end":return _context2.stop()}}),_callee2,null,[[1,19]])})));return function run(){return _ref3.apply(this,arguments)}}(),handleEditorDidMount=function handleEditorDidMount(editor,monaco){monaco.editor.defineTheme("my-theme",{base:"vs-dark",inherit:!0,rules:[],colors:{"editor.background":"#00041A"}}),monaco.editor.setTheme("my-theme")};return __jsx(chunk_6CSUKJP7.xu,(0,esm_extends.Z)({width:"100%"},rest),__jsx(chunk_ZWUY3VWT.m,{onChange:function onChange(index){return setTabIndex(index)},variant:"unstyled"},__jsx(chunk_6CSUKJP7.xu,{borderRadius:"4px 4px 0 0",alignItems:"center",padding:"0 6px",background:"#00041A",display:"flex",justifyContent:"space-between"},__jsx(chunk_ZWLVZLKQ.t,{width:"fit-content"},languages.map((function(_ref4,i){var label=_ref4.label;return __jsx(chunk_TPBRUKW6.O,{key:label,color:i===tabIndex?"blue.500":"white"},label)}))),!notExecutables.includes(languages[tabIndex].language)&&__jsx(chunk_NAA7TEES.z,{_hover:{bg:"#ffffff29"},onClick:run,variant:"ghost",size:"sm",color:"white"},__jsx(Icon.Z,{icon:"play",width:"14px",height:"14px",style:{marginRight:"5px"},color:"white"}),stTranslation?stTranslation[lang]["code-viewer"].run:t("run"))),__jsx(chunk_UCTXUILV.c,{mt:"-1.5px",height:"2px",bg:"blue.500",borderRadius:"1px"}),__jsx(chunk_45U2LZ4E.n,null,languages.map((function(_ref5,i){var code=_ref5.code,language=_ref5.language,output=_ref5.output,running=_ref5.running;return __jsx(chunk_7W5ZCZ76.x,{padding:"0"},__jsx(chunk_6CSUKJP7.xu,{height:"290px",borderRadius:!output&&"0 0 4px 4px",overflow:"hidden"},__jsx(dist.ZP,{theme:"my-theme",value:code,onChange:function onChange(value){var currLanguage=_objectSpread(_objectSpread({},languages[i]),{},{code:value});setLanguages([].concat((0,toConsumableArray.Z)(languages.slice(0,i)),[currLanguage],(0,toConsumableArray.Z)(languages.slice(i+1))))},defaultLanguage:language,height:"300px",options:{borderRadius:"4px",minimap:{enabled:!1},cursorStyle:"line"},onMount:handleEditorDidMount})),__jsx(chunk_LRMLOJAR.U,{in:running,offsetY:"20px"},__jsx(chunk_6CSUKJP7.xu,{borderTop:"1px solid #4A5568",color:"white",padding:"20px",background:"#00041A",borderRadius:"0 0 4px 4px"},__jsx(Text.Z,{display:"flex",alignItems:"center",gap:"5px",fontWeight:"700",fontSize:"14px",marginBottom:"16px",width:"fit-content",borderBottom:"2px solid white"},stTranslation?stTranslation[lang]["code-viewer"].terminal:t("terminal"),__jsx(chunk_HEDGDMHJ.u,{label:stTranslation?stTranslation[lang]["code-viewer"]["loading-output"]:t("loading-output"),placement:"right",hasArrow:!0},__jsx(chunk_6CSUKJP7.xu,null,__jsx(Icon.Z,{icon:"info",width:"14px",height:"14px",color:hexColor.blueDefault})))),__jsx(Text.Z,{whiteSpace:"pre-line",fontFamily:"monospace",padding:"8px"},output))))})))),__jsx(modalInfo.Z,{isOpen:showModal,onClose:function onClose(){return setShowModal(!1)},headerStyles:{textAlign:"center"},title:stTranslation?stTranslation[lang]["code-viewer"]["log-in-modal"].title:t("log-in-modal.title"),childrenDescription:__jsx(chunk_6CSUKJP7.xu,{display:"flex",flexDirection:"column",alignItems:"center",gridGap:"17px"},__jsx(chunk_WPAIWTI3.q,{src:"".concat(BREATHECODE_HOST,"/static/img/avatar-1.png"),border:"3px solid #0097CD",width:"91px",height:"91px",borderRadius:"50px"}),__jsx(Text.Z,{size:"14px",textAlign:"center"},stTranslation?stTranslation[lang]["code-viewer"]["log-in-modal"].text:t("log-in-modal.text"))),closeText:stTranslation?stTranslation[lang]["code-viewer"]["log-in-modal"].login:t("log-in-modal.login"),closeButtonVariant:"outline",closeButtonStyles:{borderRadius:"3px",color:hexColor.blueDefault,borderColor:hexColor.blueDefault},buttonHandlerStyles:{variant:"default"},closeActionHandler:function closeActionHandler(){(0,utils.Nh)("redirect",null==router?void 0:router.asPath),router.push("login")},actionHandler:function actionHandler(){(0,utils.Nh)("redirect",null==router?void 0:router.asPath),router.push("checkout")},handlerText:stTranslation?stTranslation[lang]["code-viewer"]["log-in-modal"].signup:t("log-in-modal.signup")}))}CodeViewer.displayName="CodeViewer",CodeViewer.propTypes={languagesData:prop_types_default().arrayOf(prop_types_default().oneOfType([prop_types_default().any])).isRequired,stTranslation:prop_types_default().objectOf(prop_types_default().oneOfType([prop_types_default().any])),allowNotLogged:prop_types_default().bool},CodeViewer.defaultProps={allowNotLogged:!1,stTranslation:null},CodeViewer.__docgenInfo={description:"",methods:[],displayName:"CodeViewer",props:{allowNotLogged:{defaultValue:{value:"false",computed:!1},description:"",type:{name:"bool"},required:!1},stTranslation:{defaultValue:{value:"null",computed:!1},description:"",type:{name:"objectOf",value:{name:"union",value:[{name:"any"}]}},required:!1},languagesData:{description:"",type:{name:"arrayOf",value:{name:"union",value:[{name:"any"}]}},required:!0}}};const components_CodeViewer=CodeViewer;var _Default$parameters,_Default$parameters2,_Logged$parameters,_Logged$parameters2,CodeViewer_stories_jsx=react.createElement;function CodeViewer_stories_ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function CodeViewer_stories_objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?CodeViewer_stories_ownKeys(Object(t),!0).forEach((function(r){(0,defineProperty.Z)(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):CodeViewer_stories_ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}const CodeViewer_stories={title:"components/Code Viewer",component:components_CodeViewer,argTypes:{allowNotLogged:{control:{type:"boolean"}},languagesData:{control:{type:"object"}}}};var Component=function Component(args,context){return CodeViewer_stories_jsx(chunk_6CSUKJP7.xu,{width:(null==args?void 0:args.width)||"500px"},CodeViewer_stories_jsx(components_CodeViewer,(0,esm_extends.Z)({stTranslation:context.parameters.i18n.store.data},args)))};Component.displayName="Component";var Default=Component.bind({});Default.args={languagesData:[{label:"JS",language:"javascript",code:"console.log(1)"},{label:"Python",language:"python",code:"print(1)"},{label:"Html",language:"html",code:"\n  <h1>Hello world!</h1>\n  <div>\n    <p>\n      This is the html test\n    </p>\n  </div>\n"}]};var Logged=Component.bind({});Logged.args={languagesData:[{label:"JS",language:"javascript",code:"console.log(1)"},{label:"Python",language:"python",code:"print(1)"}],allowNotLogged:!0},Default.parameters=CodeViewer_stories_objectSpread(CodeViewer_stories_objectSpread({},Default.parameters),{},{docs:CodeViewer_stories_objectSpread(CodeViewer_stories_objectSpread({},null===(_Default$parameters=Default.parameters)||void 0===_Default$parameters?void 0:_Default$parameters.docs),{},{source:CodeViewer_stories_objectSpread({originalSource:"(args, context) => {\n  return <Box width={args?.width || '500px'}>\n      <CodeViewer stTranslation={context.parameters.i18n.store.data} {...args} />\n    </Box>;\n}"},null===(_Default$parameters2=Default.parameters)||void 0===_Default$parameters2||null===(_Default$parameters2=_Default$parameters2.docs)||void 0===_Default$parameters2?void 0:_Default$parameters2.source)})}),Logged.parameters=CodeViewer_stories_objectSpread(CodeViewer_stories_objectSpread({},Logged.parameters),{},{docs:CodeViewer_stories_objectSpread(CodeViewer_stories_objectSpread({},null===(_Logged$parameters=Logged.parameters)||void 0===_Logged$parameters?void 0:_Logged$parameters.docs),{},{source:CodeViewer_stories_objectSpread({originalSource:"(args, context) => {\n  return <Box width={args?.width || '500px'}>\n      <CodeViewer stTranslation={context.parameters.i18n.store.data} {...args} />\n    </Box>;\n}"},null===(_Logged$parameters2=Logged.parameters)||void 0===_Logged$parameters2||null===(_Logged$parameters2=_Logged$parameters2.docs)||void 0===_Logged$parameters2?void 0:_Logged$parameters2.source)})})}}]);