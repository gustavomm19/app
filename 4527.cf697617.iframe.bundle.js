"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[4527],{"./src/common/components/OnlyFor.jsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});var _home_runner_work_app_app_node_modules_babel_runtime_helpers_esm_toConsumableArray_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/toConsumableArray.js"),react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/next/dist/compiled/react/index.js"),prop_types__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./node_modules/prop-types/index.js"),prop_types__WEBPACK_IMPORTED_MODULE_9___default=__webpack_require__.n(prop_types__WEBPACK_IMPORTED_MODULE_9__),_chakra_ui_react__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./node_modules/@chakra-ui/layout/dist/chunk-6CSUKJP7.mjs"),_chakra_ui_react__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./node_modules/@chakra-ui/button/dist/chunk-NAA7TEES.mjs"),next_router__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/next/router.js"),next_translate_useTranslation__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/next-translate/lib/esm/useTranslation.js"),_Icon__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./src/common/components/Icon/index.jsx"),_hooks_useStyle__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./src/common/hooks/useStyle.js"),_hooks_useCohortHandler__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./src/common/hooks/useCohortHandler.js"),__jsx=react__WEBPACK_IMPORTED_MODULE_0__.createElement;function Component(_ref){var withBanner=_ref.withBanner,children=_ref.children,t=(0,next_translate_useTranslation__WEBPACK_IMPORTED_MODULE_2__.Z)("common").t,_useStyle=(0,_hooks_useStyle__WEBPACK_IMPORTED_MODULE_5__.Z)(),featuredColor=_useStyle.featuredColor,backgroundColor=_useStyle.backgroundColor,router=(0,next_router__WEBPACK_IMPORTED_MODULE_1__.useRouter)();return withBanner?__jsx(react__WEBPACK_IMPORTED_MODULE_0__.Fragment,null,__jsx(_chakra_ui_react__WEBPACK_IMPORTED_MODULE_6__.xu,{display:"flex",flexDirection:{base:"column",sm:"row"},background:backgroundColor,minHeight:"auto",border:"5px solid",borderColor:featuredColor,borderRadius:"14px",p:"0",gridGap:{base:"0",sm:"26px"}},__jsx(_chakra_ui_react__WEBPACK_IMPORTED_MODULE_6__.xu,{display:"flex",justifyContent:"center",alignItems:"center",style:{aspectRatio:"1"},width:"auto",minHeight:"160px",height:{base:"160px",md:"auto"},background:featuredColor,borderRadius:"7px",m:"4px"},__jsx(_Icon__WEBPACK_IMPORTED_MODULE_3__.Z,{icon:"padlock",width:"60px",height:"65px"})),__jsx(_chakra_ui_react__WEBPACK_IMPORTED_MODULE_6__.xu,{my:"1rem",display:"flex",padding:{base:"0 16px",sm:"0"},flexDirection:"column",gridGap:"24px",width:"100%"},__jsx(_chakra_ui_react__WEBPACK_IMPORTED_MODULE_6__.xu,{p:{base:"0",sm:"0 26px 0 0"},fontSize:"18px",fontWeight:"700"},t("upgrade-plan.title")),__jsx(_chakra_ui_react__WEBPACK_IMPORTED_MODULE_7__.z,{variant:"default",onClick:function onClick(){return router.push("/login")},w:"fit-content",textTransform:"uppercase",fontSize:"14px",letterSpacing:"0.05em"},t("upgrade-plan.button")))),__jsx(_chakra_ui_react__WEBPACK_IMPORTED_MODULE_6__.xu,{display:"none"},children)):__jsx(_chakra_ui_react__WEBPACK_IMPORTED_MODULE_6__.xu,{display:"none"},children)}function OnlyFor(_ref2){var _profile$roles,_profile$roles$,_cohortSession$cohort,_cohortSession$academ,cohortSession=_ref2.cohortSession,academy=_ref2.academy,capabilities=_ref2.capabilities,children=_ref2.children,onlyMember=_ref2.onlyMember,onlyTeachers=_ref2.onlyTeachers,withBanner=_ref2.withBanner,profile=_ref2.profile,academyNumber=Math.floor(academy),cohortCapabilities=(0,_hooks_useCohortHandler__WEBPACK_IMPORTED_MODULE_4__.Z)().state.userCapabilities,profileCapabilities=(null==profile?void 0:profile.permissionsSlug)||[],userCapabilities=(0,_home_runner_work_app_app_node_modules_babel_runtime_helpers_esm_toConsumableArray_js__WEBPACK_IMPORTED_MODULE_8__.Z)(new Set([].concat((0,_home_runner_work_app_app_node_modules_babel_runtime_helpers_esm_toConsumableArray_js__WEBPACK_IMPORTED_MODULE_8__.Z)(cohortCapabilities),(0,_home_runner_work_app_app_node_modules_babel_runtime_helpers_esm_toConsumableArray_js__WEBPACK_IMPORTED_MODULE_8__.Z)(profileCapabilities)))),profileRole=(null==profile||null===(_profile$roles=profile.roles)||void 0===_profile$roles?void 0:_profile$roles.length)>0&&(null==profile||null===(_profile$roles$=profile.roles[0])||void 0===_profile$roles$||null===(_profile$roles$=_profile$roles$.role)||void 0===_profile$roles$?void 0:_profile$roles$.toUpperCase()),cohortRole=(null==cohortSession||null===(_cohortSession$cohort=cohortSession.cohort_role)||void 0===_cohortSession$cohort?void 0:_cohortSession$cohort.toUpperCase())||profileRole||"NONE",isCapableAcademy=cohortSession&&(null===(_cohortSession$academ=cohortSession.academy)||void 0===_cohortSession$academ?void 0:_cohortSession$academ.id)===academyNumber,isMember=["TEACHER","ASSISTANT","STUDENT","REVIEWER"].includes(cohortRole),isTeacher=["TEACHER","ASSISTANT","REVIEWER"].includes(cohortRole),capabilitiesNotExists=capabilities.length<=0||capabilities.includes(""),isCapableRole=capabilities.map((function(capability){return userCapabilities.includes(capability)})).includes(!0);return function haveRequiredCapabilities(){if(!cohortSession)return!1;if(onlyTeachers&&isTeacher){if(isCapableRole)return!0;if(capabilitiesNotExists)return!0}if(onlyMember&&isMember){if(isCapableRole)return!0;if(capabilitiesNotExists)return!0}return!(onlyMember||onlyTeachers||!isCapableRole)||(!(!capabilitiesNotExists||!isCapableAcademy)||!!(academy&&isCapableAcademy&&isCapableRole))}()?children:__jsx(Component,{withBanner},children)}OnlyFor.propTypes={cohortSession:prop_types__WEBPACK_IMPORTED_MODULE_9___default().objectOf(prop_types__WEBPACK_IMPORTED_MODULE_9___default().oneOfType([prop_types__WEBPACK_IMPORTED_MODULE_9___default().any])).isRequired,academy:prop_types__WEBPACK_IMPORTED_MODULE_9___default().oneOfType([prop_types__WEBPACK_IMPORTED_MODULE_9___default().string,prop_types__WEBPACK_IMPORTED_MODULE_9___default().number]),capabilities:prop_types__WEBPACK_IMPORTED_MODULE_9___default().arrayOf(prop_types__WEBPACK_IMPORTED_MODULE_9___default().string),children:prop_types__WEBPACK_IMPORTED_MODULE_9___default().node.isRequired,onlyMember:prop_types__WEBPACK_IMPORTED_MODULE_9___default().bool,onlyTeachers:prop_types__WEBPACK_IMPORTED_MODULE_9___default().bool,profile:prop_types__WEBPACK_IMPORTED_MODULE_9___default().objectOf(prop_types__WEBPACK_IMPORTED_MODULE_9___default().oneOfType([prop_types__WEBPACK_IMPORTED_MODULE_9___default().any])),withBanner:prop_types__WEBPACK_IMPORTED_MODULE_9___default().bool},OnlyFor.defaultProps={academy:"",capabilities:[],onlyMember:!1,onlyTeachers:!1,profile:{},withBanner:!1},Component.propTypes={withBanner:prop_types__WEBPACK_IMPORTED_MODULE_9___default().bool,children:prop_types__WEBPACK_IMPORTED_MODULE_9___default().node.isRequired},Component.defaultProps={withBanner:!1},OnlyFor.__docgenInfo={description:"",methods:[],displayName:"OnlyFor",props:{academy:{defaultValue:{value:"''",computed:!1},description:"",type:{name:"union",value:[{name:"string"},{name:"number"}]},required:!1},capabilities:{defaultValue:{value:"[]",computed:!1},description:"",type:{name:"arrayOf",value:{name:"string"}},required:!1},onlyMember:{defaultValue:{value:"false",computed:!1},description:"",type:{name:"bool"},required:!1},onlyTeachers:{defaultValue:{value:"false",computed:!1},description:"",type:{name:"bool"},required:!1},profile:{defaultValue:{value:"{}",computed:!1},description:"",type:{name:"objectOf",value:{name:"union",value:[{name:"any"}]}},required:!1},withBanner:{defaultValue:{value:"false",computed:!1},description:"",type:{name:"bool"},required:!1},cohortSession:{description:"",type:{name:"objectOf",value:{name:"union",value:[{name:"any"}]}},required:!0},children:{description:"",type:{name:"node"},required:!0}}};const __WEBPACK_DEFAULT_EXPORT__=(0,react__WEBPACK_IMPORTED_MODULE_0__.memo)(OnlyFor)},"./src/common/hooks/useCohortHandler.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>hooks_useCohortHandler});var defineProperty=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/defineProperty.js"),slicedToArray=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/slicedToArray.js"),axios=__webpack_require__("./node_modules/axios/lib/axios.js"),chunk_ENIANY67=__webpack_require__("./node_modules/@chakra-ui/toast/dist/chunk-ENIANY67.mjs"),useTranslation=__webpack_require__("./node_modules/next-translate/lib/esm/useTranslation.js"),next_router=__webpack_require__("./node_modules/next/router.js"),utils=__webpack_require__("./src/utils/index.js"),es=__webpack_require__("./node_modules/react-redux/es/index.js"),types=__webpack_require__("./src/common/store/types/index.js"),usePersistent=__webpack_require__("./src/common/hooks/usePersistent.js");const cohortAction=function useCohort(){var dispatch=(0,es.I0)(),_usePersistent=(0,usePersistent.K)("cohortSession",{}),persistCohortSession=(0,slicedToArray.Z)(_usePersistent,2)[1];return{state:(0,es.v9)((function(reducerState){return reducerState.cohortReducer})),setCohortSession:function setCohortSession(payload){dispatch({type:types.Rw,payload:{cohortSession:payload}}),null!=payload&&persistCohortSession(payload)},setTaskCohortNull:function setTaskCohortNull(payload){dispatch({type:types.Ze,payload:{taskCohortNull:payload}})},setSortedAssignments:function setSortedAssignments(payload){dispatch({type:types.y_,payload:{sortedAssignments:payload}})},setUserCapabilities:function setUserCapabilities(paylaod){dispatch({type:types.iG,payload:{userCapabilities:paylaod}})}}};var breathecode=__webpack_require__("./src/common/services/breathecode.js"),variables=__webpack_require__("./src/utils/variables.js"),console=__webpack_require__("./node_modules/console-browserify/index.js");function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function _objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(t),!0).forEach((function(r){(0,defineProperty.Z)(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}const hooks_useCohortHandler=function useCohortHandler(){var _router$query,_router$query2,router=(0,next_router.useRouter)(),_useTranslation=(0,useTranslation.Z)("dashboard"),t=_useTranslation.t,lang=_useTranslation.lang,_useAssignments=cohortAction(),setCohortSession=_useAssignments.setCohortSession,setTaskCohortNull=_useAssignments.setTaskCohortNull,setSortedAssignments=_useAssignments.setSortedAssignments,setUserCapabilities=_useAssignments.setUserCapabilities,state=_useAssignments.state,cohortSession=state.cohortSession,sortedAssignments=state.sortedAssignments,userCapabilities=state.userCapabilities,toast=(0,chunk_ENIANY67.p)(),accessToken=(0,utils.qn)("accessToken"),assetSlug=null==router||null===(_router$query=router.query)||void 0===_router$query?void 0:_router$query.lessonSlug,assetType=null==router||null===(_router$query2=router.query)||void 0===_router$query2?void 0:_router$query2.lesson,assetTypes={read:"lesson",practice:"exercise",project:"project",answer:"quiz"},handleRedirectToPublicPage=function handleRedirectToPublicPage(){axios.Z.get("".concat(variables.k1,"/v1/registry/asset/").concat(assetSlug)).then((function(response){var _response$data;null!=response&&null!==(_response$data=response.data)&&void 0!==_response$data&&_response$data.asset_type&&function redirectToPublicPage(data){var _data$translations,_data$translations2,englishSlug={en:null==data||null===(_data$translations=data.translations)||void 0===_data$translations?void 0:_data$translations.us},assetTypeLower=((null==data?void 0:data.asset_type)||assetTypes[assetType]).toLowerCase(),translationSlug=(null==englishSlug?void 0:englishSlug[lang])||(null==data||null===(_data$translations2=data.translations)||void 0===_data$translations2?void 0:_data$translations2[lang])||assetSlug,pathConnector={lesson:"".concat("en"===lang?"".concat(variables.fh,"/lesson/").concat(translationSlug):"".concat(variables.fh,"/").concat(lang,"/lesson/").concat(translationSlug)),exercise:"".concat("en"===lang?"".concat(variables.fh,"/interactive-exercise/").concat(translationSlug):"".concat(variables.fh,"/").concat(lang,"/interactive-exercise/").concat(translationSlug)),project:"".concat("en"===lang?"".concat(variables.fh,"/project/").concat(translationSlug):"".concat(variables.fh,"/").concat(lang,"/project/").concat(translationSlug))};null!=pathConnector&&pathConnector[assetTypeLower]&&(window.location.href=pathConnector[assetTypeLower])}(response.data)})).catch((function(){router.push("/404")}))};return{setCohortSession,setSortedAssignments,getCohortAssignments:function getCohortAssignments(_ref){var user=_ref.user,setContextState=_ref.setContextState,slug=_ref.slug,cohort=_ref.cohort;if(user){var academyId=cohort.academy.id,version=cohort.syllabus_version.version,syllabusSlug=(null==cohort?void 0:cohort.syllabus_version.slug)||slug,currentAcademy=user.roles.find((function(role){return role.academy.id===academyId}));currentAcademy&&Promise.all([breathecode.Z.todo({cohort:cohort.id,limit:1e3}).getTaskByStudent(),breathecode.Z.syllabus().get(academyId,syllabusSlug,version),breathecode.Z.auth().getRoles(null==currentAcademy?void 0:currentAcademy.role)]).then((function(_ref2){var _ref3=(0,slicedToArray.Z)(_ref2,3),taskTodoData=_ref3[0],programData=_ref3[1],userRoles=_ref3[2];setUserCapabilities(userRoles.data.capabilities),setContextState({taskTodo:taskTodoData.data.results,cohortProgram:programData.data})})).catch((function(err){console.log(err),toast({position:"top",title:t("alert-message:error-fetching-role",{role:null==currentAcademy?void 0:currentAcademy.role}),description:err.message,status:"error",duration:7e3,isClosable:!0}),router.push("/choose-program")}))}},getCohortData:function getCohortData(_ref4){var cohortSlug=_ref4.cohortSlug;return new Promise((function(resolve,reject){cohortSlug&&accessToken?breathecode.Z.admissions().me().then((function(_ref5){var data=_ref5.data;if(!data)throw new Error("No data");var findCohort=data.cohorts.find((function(c){return c.cohort.slug===cohortSlug})),currentCohort=null==findCohort?void 0:findCohort.cohort;if(assetSlug&&!currentCohort&&handleRedirectToPublicPage(),currentCohort){var syllabus_version=currentCohort.syllabus_version;setCohortSession(_objectSpread(_objectSpread(_objectSpread({},cohortSession),currentCohort),{},{selectedProgramSlug:"/cohort/".concat(currentCohort.slug,"/").concat(syllabus_version.slug,"/v").concat(syllabus_version.version),cohort_role:findCohort.role,cohort_user:{created_at:findCohort.created_at,educational_status:findCohort.educational_status,finantial_status:findCohort.finantial_status,role:findCohort.role}})),resolve(currentCohort)}})).catch((function(error){handleRedirectToPublicPage(),toast({position:"top",title:t("alert-message:invalid-cohort-slug"),status:"error",duration:7e3,isClosable:!0}),reject(error),setTimeout((function(){localStorage.removeItem("cohortSession")}),4e3)})):handleRedirectToPublicPage()}))},prepareTasks:function prepareTasks(_ref6){var _cohortProgram$json,_cohortProgram$json2,cohortProgram=_ref6.cohortProgram,contextState=_ref6.contextState,nestAssignments=_ref6.nestAssignments,moduleData=(null===(_cohortProgram$json=cohortProgram.json)||void 0===_cohortProgram$json?void 0:_cohortProgram$json.days)||(null===(_cohortProgram$json2=cohortProgram.json)||void 0===_cohortProgram$json2?void 0:_cohortProgram$json2.modules),cohort=cohortProgram.json?moduleData:[],assignmentsRecopilated=[];(0,utils.Cv)("json.days:",moduleData),contextState.cohortProgram.json&&contextState.taskTodo&&cohort.map((function(assignment){var id=assignment.id,label=assignment.label,description=assignment.description,lessons=assignment.lessons,replits=assignment.replits,assignments=assignment.assignments,quizzes=assignment.quizzes;if(lessons&&replits&&assignments&&quizzes){var nestedAssignments=nestAssignments({id,read:lessons,practice:replits,project:assignments,answer:quizzes,taskTodo:contextState.taskTodo}),modules=nestedAssignments.modules,filteredModules=nestedAssignments.filteredModules,filteredModulesByPending=nestedAssignments.filteredModulesByPending,assignmentsStruct={id,label,description,modules,exists_activities:(null==modules?void 0:modules.length)>0,filteredModules,filteredModulesByPending:(null==modules?void 0:modules.length)>0?filteredModulesByPending:null,duration_in_days:(null==assignment?void 0:assignment.duration_in_days)||null,teacherInstructions:assignment.teacher_instructions,extendedInstructions:assignment.extended_instructions||"".concat(t("teacher-sidebar.no-instructions")),keyConcepts:assignment["key-concepts"]},keyIndex=assignmentsRecopilated.findIndex((function(x){return x.id===id}));keyIndex>-1?assignmentsRecopilated.splice(keyIndex,1,_objectSpread({},assignmentsStruct)):assignmentsRecopilated.push(_objectSpread({},assignmentsStruct));var filterNotEmptyModules=assignmentsRecopilated.filter((function(l){return l.modules.length>0}));return setSortedAssignments(filterNotEmptyModules)}return null}))},getDailyModuleData:function getDailyModuleData(){return sortedAssignments.find((function(assignment){return assignment.id===(null==cohortSession?void 0:cohortSession.current_module)}))},getMandatoryProjects:function getMandatoryProjects(){return sortedAssignments.flatMap((function(assignment){return assignment.filteredModules.filter((function(l){return"PROJECT"===l.task_type&&"PENDING"===l.task_status&&!0===l.mandatory&&l.daysDiff>=14}))}))},getTasksWithoutCohort:function getTasksWithoutCohort(_ref7){var setModalIsOpen=_ref7.setModalIsOpen;return router.asPath===cohortSession.selectedProgramSlug&&breathecode.Z.todo({cohort:null}).getTaskByStudent().then((function(_ref8){var data=_ref8.data,filteredUnsyncedCohortTasks=sortedAssignments.flatMap((function(assignment){return data.filter((function(task){return assignment.modules.some((function(module){return task.associated_slug===module.slug}))}))}));setModalIsOpen(0!==filteredUnsyncedCohortTasks.length),setTaskCohortNull(filteredUnsyncedCohortTasks)})),function(){}},userCapabilities,state}}}}]);